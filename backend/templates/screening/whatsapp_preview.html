<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Open WhatsApp</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; background: #fafafa; color: #111; }
      .container { max-width: 820px; margin: 0 auto; }
      .card { background: #fff; border: 1px solid #eee; border-radius: 14px; padding: 16px; margin: 12px 0; }
      pre { white-space: pre-wrap; background: #f6f6f6; padding: 12px; border-radius: 10px; border: 1px solid #eee; }
      a.button {
        display: inline-block;
        padding: 10px 16px;
        text-decoration: none;
        border-radius: 10px;
        border: 1px solid #ddd;
        background: #fff;
        color: #111;
      }
      a.button.primary { background: #111; color: #fff; border-color: #111; }
      .muted { color: #666; font-size: 14px; margin: 6px 0 0 0; }
      .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="card">
        <h2 style="margin: 0;">Ready to message the parent</h2>
        <p class="muted">If WhatsApp didnâ€™t open automatically, tap the button below.</p>

        <div class="actions">
          <a
            id="open-wa-btn"
            class="button primary"
            href="{{ wa_url }}"
            target="_blank"
            rel="noopener noreferrer"
          >
            Open WhatsApp
          </a>
          <a class="button" href="{{ next_url }}">Continue</a>
        </div>
      </div>

      <div class="card">
        <h3 style="margin: 0 0 10px 0;">Message preview</h3>
        <pre>{{ message_text }}</pre>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var btn = document.getElementById("open-wa-btn");
        if (!btn) return;
    
        btn.addEventListener("click", function (e) {
          e.preventDefault();
    
          var waUrl = "{{ wa_url|escapejs }}";
          var nextUrl = "{{ next_url|escapejs }}";
    
          // Open WhatsApp in a new tab
          window.open(waUrl, "_blank");
    
          // Redirect current tab back (we will set next_url to the teacher dashboard)
          if (nextUrl) {
            window.location.href = nextUrl;
          }
        });
      });
    </script>
  </body>
</html>
