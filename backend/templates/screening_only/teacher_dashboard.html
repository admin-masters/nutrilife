<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Teacher Dashboard</title>
  <style>
    body{font-family:system-ui;max-width:980px;margin:0 auto;padding:1rem;background:#fafafa}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;margin-bottom:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    select,input{padding:10px;border:1px solid #ddd;border-radius:10px}
    a.btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;text-decoration:none}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:.6rem;border-bottom:1px solid #eee;text-align:left}
    .badge{padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid #ddd}
    .red{background:#fee2e2;border-color:#fecaca}
    .green{background:#dcfce7;border-color:#bbf7d0}
    .muted{color:#666}
  </style>
</head>
<body>
  <div class="card">
    <h2>Teacher Dashboard – {{ org.name }}</h2>
    <p class="muted">Choose screening language and class/division. Screen new students or re-screen existing students.</p>

    <form method="get" class="row">
      <select name="lang">
        <option value="en" {% if lang == "en" %}selected{% endif %}>English</option>
        <option value="hi" {% if lang == "hi" %}selected{% endif %}>Hindi</option>
        <option value="local" {% if lang == "local" %}selected{% endif %}>Local</option>
      </select>

      <select name="classroom">
        <option value="">All Classes</option>
        {% for c in classrooms %}
          <option value="{{ c.id }}" {% if c.id|stringformat:"s" == selected_classroom_id %}selected{% endif %}>
            Class {{ c.grade }} - {{ c.division }}
          </option>
        {% endfor %}
      </select>

      <input name="q" placeholder="Search student..." value="{{ q }}"/>

      <button class="btn" type="submit" style="border:none;">Apply</button>
      <a class="btn" href="{{ add_student_url }}">Screening form for a new student</a>
    </form>
  </div>

  <div class="card">
    <h3>Students</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Class</th>
          <th>Last screened</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for s in students %}
          <tr>
            <td>{{ s.full_name }}</td>
            <td>
              {% if s.classroom %}
                {{ s.classroom.grade }} - {{ s.classroom.division }}
              {% else %}
                —
              {% endif %}
            </td>
            <td>{% if s.last_screened_at %}{{ s.last_screened_at|date:"Y-m-d" }}{% else %}—{% endif %}</td>
            <td>
              {% if s.last_risk == "RED" %}
                <span class="badge red">Red flagged</span>
              {% elif s.last_risk %}
                <span class="badge green">Normal</span>
              {% else %}
                <span class="badge">Not screened</span>
              {% endif %}
            </td>
            <td>
              <a class="btn" href="{{ s.screening_url }}">Fill Screening form</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="5">No students found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>
